sum((c(10.9, 8.1, 5.2)-8.1)^2)+sum(c(2.5, 3.5)-3)^2)+sum(c(4.2, 6.3)-5.3)^2)+sum(c(4.5,2.5,3.1)-3.4)^2))/10
sum((c(10.9, 8.1, 5.2)-8.1)^2)+sum(c(2.5, 3.5)-3)^2)+sum(c(4.2, 6.3)-5.3)^2)+sum(c(4.5,2.5,3.1)-3.4)^2))
sum((c(10.9, 8.1, 5.2)-8.1)^2)+sum(c(2.5, 3.5)-3)^2)+sum(c(4.2, 6.3)-5.3)^2)+sum(c(4.5,2.5,3.1)-3.4)^2)
sum((c(10.9, 8.1, 5.2)-8.1)^2)+sum((c(2.5, 3.5)-3)^2)+sum(c(4.2, 6.3)-5.3)^2)+sum(c(4.5,2.5,3.1)-3.4)^2)
((6.1-5.3)^2+(7.9-8.1)^2+(4-3.4)^2)/3
sum((c(10.9, 8.1, 5.2)-8.1)^2)+sum((c(2.5, 3.5)-3)^2)+sum((c(4.2, 6.3)-5.3)^2)+sum((c(4.5,2.5,3.1)-3.4)^2)
(sum((c(10.9, 8.1, 5.2)-8.1)^2)+sum((c(2.5, 3.5)-3)^2)+sum((c(4.2, 6.3)-5.3)^2)+sum((c(4.5,2.5,3.1)-3.4)^2))/10
library(modelsummary)
?modelplot
set.seed(42)
library(tidyverse)
library(tidyverse)
df <- read_excel("C:/Users/gumac/Downloads/dados.xlsx")
library(readxl)
df <- read_excel("C:/Users/gumac/Downloads/dados.xlsx")
df %>%
View()
df %>%
ggplot(aes())
df %>%
select(c("ano" = "ano"))
df %>%
select(c("Ano" = "ano"))
columns(df)
cols(df)
col(df)
cols(df)
?cols
colnames(df)
?pivot_longer
df %>%
pivot_longer(
cols = starts_with("Veículos Envolvidos"),
names_to = "test"
)
df %>%
pivot_longer(
cols = starts_with("Veículos Envolvidos"),
names_to = "test"
)  %>%
View()
df %>% View()
df %>%
pivot_longer(cols = starts_with("Veículos Envolvidos"))  %>%
View()
df %>%
pivot_longer(cols = starts_with("Veículos Envolvidos"))
df %>%
pivot_longer(cols = starts_with("Veículos Envolvidos")) %>% View()
df %>%
pivot_longer(cols = starts_with("Veículos Envolvidos")) %>%
ggplot(aes(x = name)) %>%
geom_histogram()
df %>%
pivot_longer(cols = starts_with("Veículos Envolvidos")) %>%
ggplot(aes(x = name)) +
geom_histogram()
df %>%
pivot_longer(cols = starts_with("Veículos Envolvidos")) %>%
ggplot(aes(x = name)) +
geom_histogram(stat = "count")
df %>%
pivot_longer(cols = starts_with("Veículos Envolvidos")) %>%
ggplot(aes(x = name)) +
geom_histogram(stat = "sum")
df %>%
colnames()
df %>%
select(
"Bicicleta": "Veículos Envolvidos - Bicicleta"
)
df %>%
select(
"Bicicleta" = "Veículos Envolvidos - Bicicleta"
)
df %>%
colnames()
df %>%
select(
"bicicleta" = "Veículos Envolvidos - Bicicleta",
"caminhao" = "Veículos Envolvidos - Caminhão",
"automovel" = "Veículos Envolvidos - Automóvel",
"motocicleta" = "Veículos Envolvidos - Ônibus",
"onibus" = "Veículos Envolvidos - Bicicleta",
"pedestre" = "Veículos Envolvidos - Pedestre",
)
df %>%
select(
"bicicleta" = "Veículos Envolvidos - Bicicleta",
"caminhao" = "Veículos Envolvidos - Caminhão",
"automovel" = "Veículos Envolvidos - Automóvel",
"motocicleta" = "Veículos Envolvidos - Ônibus",
"onibus" = "Veículos Envolvidos - Bicicleta",
"pedestre" = "Veículos Envolvidos - Pedestre",
) %>%
summarize(
bicicletas = sum(bicicletas)
)
df %>%
select(
"bicicleta" = "Veículos Envolvidos - Bicicleta",
"caminhao" = "Veículos Envolvidos - Caminhão",
"automovel" = "Veículos Envolvidos - Automóvel",
"motocicleta" = "Veículos Envolvidos - Ônibus",
"onibus" = "Veículos Envolvidos - Bicicleta",
"pedestre" = "Veículos Envolvidos - Pedestre",
) %>%
summarize(
bicicletas = sum(bicicleta)
)
setwd("C:/git/PEE")
library(tidyverse)
library(sf)
passe_livre <- read.csv("dados/passe_livre.csv")
df <- read.csv("output/data.csv")
View(df)
#Mapa dos grupos de município ----
df <- passe_livre %>%
mutate(id_municipio = as.character(id_municipio)) %>%
left_join(df.rm.idd %>%
distinct(id_municipio) %>%
mutate(area_metrop = 1,
id_municipio = as.character(id_municipio))) %>%
mutate(area_metrop = ifelse(is.na(area_metrop), 0, 1),
code_muni = as.double(id_municipio))
load("C:/git/PEE/dados/df_rm_idd.RData")
#Mapa dos grupos de município ----
df <- passe_livre %>%
mutate(id_municipio = as.character(id_municipio)) %>%
left_join(df.rm.idd %>%
distinct(id_municipio) %>%
mutate(area_metrop = 1,
id_municipio = as.character(id_municipio))) %>%
mutate(area_metrop = ifelse(is.na(area_metrop), 0, 1),
code_muni = as.double(id_municipio))
data <- left_join(municipios, df) %>%
mutate(fill = ifelse((passe_livre == 1 & area_metrop == 1), "Passe Livre",
ifelse(area_metrop == 1, "Área Metropolitana",
ifelse((passe_livre == 1), "Passe Livre Fora da Análise", "Fora da Análise"))))
load("C:/git/PEE/dados/municipios_geometria.RData")
ggplot() +
geom_sf(data = data %>% filter(turno == 2),
aes(fill = factor(fill)), color = NA) +
scale_fill_manual(values = c("Área Metropolitana" = "#213A5C",
"Passe Livre" = "red",
"Passe Livre Fora da Análise" = "#758D93",
"Fora da Análise" = "#90A4B0")) +
labs(fill = "Grupo") +
theme_void()
data <- left_join(municipios, df) %>%
mutate(fill = ifelse((passe_livre == 1 & area_metrop == 1), "Passe Livre",
ifelse(area_metrop == 1, "Área Metropolitana",
ifelse((passe_livre == 1), "Passe Livre Fora da Análise", "Fora da Análise"))))
ggplot() +
geom_sf(data = data %>% filter(turno == 2),
aes(fill = factor(fill)), color = NA) +
scale_fill_manual(values = c("Área Metropolitana" = "#213A5C",
"Passe Livre" = "red",
"Passe Livre Fora da Análise" = "#758D93",
"Fora da Análise" = "#90A4B0")) +
labs(fill = "Grupo") +
theme_void()
ggplot() +
geom_sf(data = data %>% filter(turno == 2, abbrev_state == "RS"),
aes(fill = factor(fill)), color = "#8D989F") +
scale_fill_manual(values = c("Área Metropolitana" = "#213A5C",
"Passe Livre" = "#006600",
"Passe Livre Fora da Análise" = "#90A4B0",
"Fora da Análise" = "#758D93")) +
labs(fill = "Grupo") +
theme_void()
df %>%
filter(faixa_etaria != "Inválido", ano == 2022) %>%
group_by(ano, turno, faixa_etaria) %>%
summarize(aptos = sum(aptos), comparecimento = sum(comparecimento)) %>%
mutate(comparecimento = comparecimento/aptos,
comparecimento = ifelse(turno == 1, -comparecimento, comparecimento),
faixa_etaria = fct_relevel(faixa_etaria, "100 anos ou mais", after = Inf)) %>%
ggplot(aes(x = faixa_etaria, y = comparecimento, fill = factor(turno))) +
geom_col() +
coord_flip() +
facet_wrap(~ano) +
scale_y_continuous(labels = scales::percent_format(),
breaks = c(0, 0.25, .5, .75, -0.25, -.5, -.75)) +
labs(x = "", y = "Comparecimento", fill = "Turno")
df <- read.csv("output/data.csv")
df %>%
filter(faixa_etaria != "Inválido", ano == 2022) %>%
group_by(ano, turno, faixa_etaria) %>%
summarize(aptos = sum(aptos), comparecimento = sum(comparecimento)) %>%
mutate(comparecimento = comparecimento/aptos,
comparecimento = ifelse(turno == 1, -comparecimento, comparecimento),
faixa_etaria = fct_relevel(faixa_etaria, "100 anos ou mais", after = Inf)) %>%
ggplot(aes(x = faixa_etaria, y = comparecimento, fill = factor(turno))) +
geom_col() +
coord_flip() +
facet_wrap(~ano) +
scale_y_continuous(labels = scales::percent_format(),
breaks = c(0, 0.25, .5, .75, -0.25, -.5, -.75)) +
labs(x = "", y = "Comparecimento", fill = "Turno")
df.temp <- df %>%
as_tibble() %>%
left_join(passe_livre) %>%
filter(ano == 2022, turno == 2) %>%
group_by(passe_livre) %>%
summarize(comparecimento = sum(comparecimento) / sum(aptos)) %>%
drop_na() %>%
mutate(passe_livre = ifelse(passe_livre == 1, "Adotou", "Não Adotou")) %>%
mutate(bonus = ifelse(passe_livre == "Adotou",max(comparecimento) - min(comparecimento), 0),
comparecimento = min(comparecimento)) %>%
pivot_longer(cols = c(comparecimento, bonus))
line1 <- df.temp %>%
filter(passe_livre == "Não Adotou") %>%
pull(value) %>%
max()
line2 <- df.temp %>%
filter(passe_livre == "Adotou") %>%
summarize(valor = sum(value)) %>%
pull(valor)
df.temp %>%
ggplot(aes(x = reorder(passe_livre, value), y = value, fill = name)) +
geom_col() +
geom_hline(yintercept = line1, linetype = "dashed") +
geom_hline(yintercept = line2, linetype = "dashed") +
coord_cartesian(ylim = c(0.7,0.85)) +
labs(y = "Comparecimento", x = "Passe Livre") +
scale_fill_manual(values = c("comparecimento" = "#46417D", "bonus" = "#ACA9D3")) +
scale_y_continuous(labels = scales::percent_format()) +
theme(legend.position = "none")
df
df %>% View()
df %>%
filter(ano == 2022)
df %>%
filter(ano == 2022) %>%
View()
df %>%
filter(ano == 2022, turno ==2 ) %>%
View()
df %>%
filter(ano == 2022, turno == 2) %>%
View()
df %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio) %>%
summarize(comparecimento_tx = sum(comparecimento) / sum(aptos))
df %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio) %>%
summarize(comparecimento_tx = sum(comparecimento) / sum(aptos)) %>%
left_join(municipio)
df %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio) %>%
summarize(comparecimento_tx = sum(comparecimento) / sum(aptos)) %>%
left_join(municipios)
df %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio) %>%
summarize(comparecimento_tx = sum(comparecimento) / sum(aptos)) %>%
mutate(code_muni = as.double(id_municipio)) %>%
left_join(municipios)
df %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio) %>%
summarize(comparecimento_tx = sum(comparecimento) / sum(aptos)) %>%
mutate(code_muni = as.double(id_municipio)) %>%
left_join(municipios) %>%
ggplot() +
geom_sf(aes(fill = comparecimento_tx), color = NA)
df %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio) %>%
summarize(comparecimento_tx = sum(comparecimento) / sum(aptos)) %>%
mutate(code_muni = as.double(id_municipio)) %>%
left_join(municipios) %>% View()
ggplot() +
geom_sf(aes(fill = comparecimento_tx, geometry = geom), color = NA)
df %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio) %>%
summarize(comparecimento_tx = sum(comparecimento) / sum(aptos)) %>%
mutate(code_muni = as.double(id_municipio)) %>%
left_join(municipios) %>%
ggplot() +
geom_sf(aes(fill = comparecimento_tx, geometry = geom), color = NA)
df %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio) %>%
summarize(comparecimento_tx = sum(comparecimento) / sum(aptos)) %>%
mutate(code_muni = as.double(id_municipio)) %>%
left_join(municipios) %>%
ggplot() +
geom_sf(aes(fill = comparecimento_tx, geometry = geom), color = NA) +
theme_void()
df %>%
distinct(faixa_etaria)
df %>%
mutate(fct_collapse(faixa_etaria,
"Acima de 60" = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other = "Abaixo de 60"))
df %>%
mutate(fct_collapse(faixa_etaria,
"Acima de 60" = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = "Abaixo de 60"))
df %>%
mutate(fct_collapse(faixa_etaria,
"Acima de 60" = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = "Abaixo de 60")) %>%
View()
df %>%
mutate(faixa_etaria =
fct_collapse(faixa_etaria,
"Acima de 60" = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = "Abaixo de 60")) %>%
View()
df %>%
mutate(faixa_etaria =
fct_collapse(faixa_etaria,
"Acima de 60" = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = "Abaixo de 60")) %>%
pivot_wider(names_from = faixa_etaria, values_from = aptos)
df %>%
mutate(faixa_etaria =
fct_collapse(faixa_etaria,
"Acima de 60" = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = "Abaixo de 60")) %>%
pivot_wider(names_from = faixa_etaria, values_from = aptos) %>% View()
df %>%
mutate(faixa_etaria =
fct_collapse(faixa_etaria,
"Acima de 60" = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = "Abaixo de 60")) %>% View()
df %>%
mutate(faixa_etaria =
fct_collapse(faixa_etaria,
"Acima de 60" = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = "Abaixo de 60")) %>%
pivot_wider(names_from = faixa_etaria, values_from = aptos) %>% View()
df %>%
mutate(faixa_etaria =
fct_collapse(faixa_etaria,
"Acima de 60" = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = "Abaixo de 60")) %>%
filter(ano == 2022, turno == 2) %>% View()
df %>%
mutate(faixa_etaria =
fct_collapse(faixa_etaria,
"Acima de 60" = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = "Abaixo de 60")) %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio, faixa_etaria) %>%
summarize(aptos = sum(aptos)) %>%
pivot_wider(names_from = faixa_etaria, values_from = aptos) %>% View()
df %>%
mutate(faixa_etaria =
fct_collapse(faixa_etaria,
nao_idosos = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = idosos)) %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio, faixa_etaria) %>%
summarize(aptos = sum(aptos)) %>%
pivot_wider(names_from = faixa_etaria, values_from = aptos) %>%
mutate(dependencia = idosos / naoidosos)
df %>%
mutate(faixa_etaria =
fct_collapse(faixa_etaria,
nao_idosos = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = "idosos")) %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio, faixa_etaria) %>%
summarize(aptos = sum(aptos)) %>%
pivot_wider(names_from = faixa_etaria, values_from = aptos) %>%
mutate(dependencia = idosos / naoidosos)
df %>%
mutate(faixa_etaria =
fct_collapse(faixa_etaria,
"nao_idosos" = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = "idosos")) %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio, faixa_etaria) %>%
summarize(aptos = sum(aptos)) %>%
pivot_wider(names_from = faixa_etaria, values_from = aptos) %>%
mutate(dependencia = idosos / naoidosos)
df %>%
mutate(faixa_etaria =
fct_collapse(faixa_etaria,
nao_idosos = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = "idosos")) %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio, faixa_etaria) %>%
summarize(aptos = sum(aptos)) %>%
pivot_wider(names_from = faixa_etaria, values_from = aptos) %>%
mutate(dependencia = idosos / nao_idosos)
df %>%
mutate(faixa_etaria =
fct_collapse(faixa_etaria,
idosos = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = nao_idosos)) %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio, faixa_etaria) %>%
summarize(aptos = sum(aptos)) %>%
pivot_wider(names_from = faixa_etaria, values_from = aptos) %>%
mutate(dependencia = idosos / nao_idosos)
df %>%
mutate(faixa_etaria =
fct_collapse(faixa_etaria,
idosos = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = "nao_idosos")) %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio, faixa_etaria) %>%
summarize(aptos = sum(aptos)) %>%
pivot_wider(names_from = faixa_etaria, values_from = aptos) %>%
mutate(dependencia = idosos / nao_idosos)
df %>%
mutate(faixa_etaria =
fct_collapse(faixa_etaria,
idosos = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = "nao_idosos")) %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio, faixa_etaria) %>%
summarize(aptos = sum(aptos)) %>%
pivot_wider(names_from = faixa_etaria, values_from = aptos) %>%
mutate(dependencia = idosos / nao_idosos) %>%
mutate(code_muni = as.double(id_municipio)) %>%
left_join(municipios) %>%
ggplot() +
geom_sf(aes(fill = dependencia, geometry = geom), color = NA) +
theme_void()
df %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio) %>%
summarize(comparecimento_tx = sum(comparecimento) / sum(aptos)) %>%
mutate(code_muni = as.double(id_municipio)) %>%
left_join(municipios) %>%
ggplot() +
geom_sf(aes(fill = comparecimento_tx, geometry = geom), color = NA) +
theme_void()
df %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio) %>%
summarize(comparecimento_tx = sum(comparecimento) / sum(aptos)) %>%
mutate(code_muni = as.double(id_municipio)) %>%
left_join(municipios) %>%
ggplot() +
geom_sf(aes(fill = comparecimento_tx, geometry = geom), color = NA) +
theme_void() +
scale_fill_brewer()
df %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio) %>%
summarize(comparecimento_tx = sum(comparecimento) / sum(aptos)) %>%
mutate(code_muni = as.double(id_municipio)) %>%
left_join(municipios) %>%
ggplot() +
geom_sf(aes(fill = comparecimento_tx, geometry = geom), color = NA) +
theme_void() +
scale_fill_viridis_c()
ggsave("output/mapa_comparecimento.png", dpi = 1200, width = 10, height = 10)
df %>%
mutate(faixa_etaria =
fct_collapse(faixa_etaria,
idosos = c("100 anos ou mais", "95 a 99 anos", "90 a 94 anos",
"85 a 89 anos", "80 a 84 anos", "75 a 79 anos",
"70 a 74 anos", "65 a 69 anos", "60 a 64 anos"),
other_level = "nao_idosos")) %>%
filter(ano == 2022, turno == 2) %>%
group_by(id_municipio, faixa_etaria) %>%
summarize(aptos = sum(aptos)) %>%
pivot_wider(names_from = faixa_etaria, values_from = aptos) %>%
mutate(dependencia = idosos / nao_idosos) %>%
mutate(code_muni = as.double(id_municipio)) %>%
left_join(municipios) %>%
ggplot() +
geom_sf(aes(fill = dependencia, geometry = geom), color = NA) +
theme_void() +
scale_fill_viridis_c()
ggsave("output/mapa_dependencia.png", dpi = 1200, width = 10, height = 10)
